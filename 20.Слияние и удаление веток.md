# Объединяем и удаляем ветки

Представьте, что закончили разработку новой функциональности в отдельной ветке и готовы объединить её с главной — добавить свои изменения в основную версию проекта. Этот процесс называется слиянием веток.

В этом уроке разберём, как «мёржить» (от англ. merge — «сливать», «поглощать») ветки, то есть объединять их. А также как удалять ненужные ветки из репозитория.

## Выполнить слияние — git merge <название_ветки>

Откройте проект git-branches из предыдущей темы. Напомним, что сейчас состояние репозитория следующее.

![ ](https://pictures.s3.yandex.net/resources/M3_T3-3_1687851153.png)

Перед тем как начать процесс слияния, нужно перейти в ветку, куда должны добавиться изменения. Обычно это главная ветка. Перейдите в неё и вызовите команду git merge с именем присоединяемой ветки feature/diff в качестве параметра.

```
$ git checkout main # переключились на главную ветку

$ git merge feature/diff # объединили ветки
Updating 079cfbf..f30d441
Fast-forward
 README.md | 2 ++
 1 file changed, 2 insertions(+) 
```
 
**?? Обратите внимание: в процессе выполнения задания может открыться редактор кода Vim. Для выхода нажмите Esc, введите сочетание :qa! и нажмите Enter.**
 
Объединение веток прошло успешно! Все коммиты из feature/diff добавлены в главную ветку. В сообщении после слияния содержится следующая информация:
 
* Updating 079cfbf..f30d441 — значит, что коммиты c 079cfbf по f30d441 были объединены.

* Fast-forward — это режим слияния. Fast-forward (англ. «перемотка») значит, что итогом слияния будет линейная история коммитов. Такое происходит, когда истории двух веток находятся на одной прямой — то есть когда одна ветка продолжает историю, начатую другой, как в нашем примере.

* Информация о конкретных изменениях. В нашем примере поменялся файл README.md (1 file changed): в нём теперь две новые строки (2 insertions(+)).

После слияния веток main и feature/diff репозиторий перейдёт в следующее состояние.

![ ](https://pictures.s3.yandex.net/resources/M3_T4_1687851163.png)

Основная ветка и feature/diff теперь указывают на один коммит. Вы можете проверить это с помощью git log --oneline.

```
$ git log --oneline

f30d441 (HEAD -> main, feature/diff) Добавить описание git diff в README
079cfbf Добавить git branch в README.
7ad18bd Добавить файл README 
```

Откройте файл README.md и убедитесь, что теперь он содержит информацию из обеих веток.

## Удалить ветку после объединения — git branch -D <название_ветки>

После того как произошло слияние, ветку-донора можно удалить. Для этого в основной ветке введите команду git branch с флагом -D (от англ. delete — «удалить») и названием ветки.

```
$ git branch # проверяем местоположение
  bugfix/fix-branch
  feature/add-branch-info
  feature/diff
* main

$ git checkout main # если не в основной, переходим в неё

$ git branch -D feature/diff # удаляем поглощаемую ветку
Deleted branch feature/diff (was f30d441). 
```

Ветка feature/diff удалена — об этом говорит сообщение Deleted branch feature/diff.

**?? Если в момент удаления вы будете находиться в той ветке, которую хотите удалить, Git сообщит об ошибке: can not delete branch (англ. «не получается удалить ветку»).**

У команды git branch -D есть более безопасный вариант с флагом -d. Он удалит ветку только если она была полностью объединена с другой — то есть если две ветки стали (или изначально были) частью одной истории. Например, если вы нечаянно создали ветку с неправильным названием, её можно удалить через git branch -d %имя_ветки%.

**?? Удаление локальной ветки через Git не удаляет ветку на GitHub!**

### Поздравляем! Теперь вы понимаете, как работает ветвление в Git. Что важно запомнить:

* Выполнить слияние веток позволяет команда git merge <название_ветки>. В качестве параметра указывают название ветки, которую нужно влить в текущую.

* Удалять ненужные ветки после слияния — хорошая практика. Так в вашем репозитории всегда будет порядок. За удаление веток отвечает команда git branch -D <название_ветки> и её щадящий вариант с флагом -d.

## Что такое конфликт

Когда сразу несколько членов команды работают над одним и тем же фрагментом проекта в разных ветках, при слиянии могут происходить конфликты. Рассмотрим, как это бывает и что делать в такой ситуации.

## Знакомьтесь: конфликт

Допустим, вы решили отредактировать параграф текста и исправить опечатки. В этот момент ваш коллега поменял тот же самый параграф в соседней ветке change/github-info и влил изменения в main.

После завершения работы вы делаете финальный коммит в своей ветке edit/fix-typoes, переходите в основную и пытаетесь выполнить слияние. Но в терминале появляется такое сообщение.

```
$ git commit -m "Исправить опечатки" && git checkout main
$ git merge edit/fix-typoes
Auto-merging pages/table-of-content.txt # тут Git самостоятельно внёс изменения 
CONFLICT (content): Merge conflict in github.txt # здесь возник конфликт
Automatic merge failed; fix conflicts and then commit the result # слияния не произошло 
```

На схеме эта ситуация может выглядеть так.

![ ](https://pictures.s3.yandex.net/resources/M3_T3-5_1687852525.png)

Если Git не может провести слияние изменений автоматически, он сообщает о конфликте. Конфликт — это ситуация, в которой один или несколько человек модифицировали один и тот же файл. При этом результаты таких модификаций оказались несовместимы и разобраться в том, какой из вариантов правильный, может только человек.

В разработке, например, конфликты чаще всего возникают, когда несколько программистов одновременно меняют код в одном и том же месте.

## Как разрешать конфликты: общие рекомендации

Во время слияния Git сам подсвечивает файлы, которые не смог объединить. Чтобы разобраться в ситуации, нужно сделать следующее:

1. Заглянуть в файл, где произошёл конфликт.

2. Изучить обе стороны конфликта — вашу версию и версию вашего коллеги. Ваша задача — правильно собрать две версии в итоговую, так чтобы изменения обеих сторон не потерялись. Новая версия станет текущей актуальной.

3. Вручную удалить или подправить неактуальные изменения, если они есть.

4. Подготовить изменения к сохранению и сделать коммит.

![ ](https://pictures.s3.yandex.net/resources/Untitled-110_1687531034.png)

Подробнее о том, как работать с конфликтами, мы ещё расскажем дальше в курсе. Также узнать об этом больше можно из [официальной документации Git](https://git-scm.com/book/ru/v2/%D0%98%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-Git-%D0%9F%D1%80%D0%BE%D0%B4%D0%B2%D0%B8%D0%BD%D1%83%D1%82%D0%BE%D0%B5-%D1%81%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D0%B5).

Не переживайте, если в ходе слияния веток что-то пойдёт не по плану. При командной работе конфликты неизбежны. Чем больше веток, тем выше риск возникновения конфликта. Главное помнить, что его всегда можно разрешить!